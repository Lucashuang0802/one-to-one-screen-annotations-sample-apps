(function(){var n,e,t,o={},i=function(n,t){e&&e.triggerEvent(n,t)},r=function(){var n=["startAnnotation","linkAnnotation","resizeCanvas","annotationWindowClosed","endAnnotation"];e.registerEvents(n)},a=function(){var n=['<div id="toolbar"></div>'].join("\n");$("body").append(n)},s=[{id:"OT_pen",title:"Pen",icon:"../images/annotation/freehand.png",selectedIcon:"../images/annotation/freehand_selected.png"},{id:"OT_line",title:"Line",icon:"../images/annotation/line.png",selectedIcon:"../images/annotation/line_selected.png"},{id:"OT_text",title:"Text",icon:"../images/annotation/text.png",selectedIcon:"../images/annotation/text.png"},{id:"OT_shapes",title:"Shapes",icon:"../images/annotation/shapes.png",items:[{id:"OT_arrow",title:"Arrow",icon:"../images/annotation/arrow.png"},{id:"OT_rect",title:"Rectangle",icon:"../images/annotation/rectangle.png"},{id:"OT_oval",title:"Oval",icon:"../images/annotation/oval.png"},{id:"OT_star",title:"Star",icon:"../images/annotation/star.png",points:[[.5+.5*Math.cos(90*(Math.PI/180)),.5+.5*Math.sin(90*(Math.PI/180))],[.5+.25*Math.cos(126*(Math.PI/180)),.5+.25*Math.sin(126*(Math.PI/180))],[.5+.5*Math.cos(162*(Math.PI/180)),.5+.5*Math.sin(162*(Math.PI/180))],[.5+.25*Math.cos(198*(Math.PI/180)),.5+.25*Math.sin(198*(Math.PI/180))],[.5+.5*Math.cos(234*(Math.PI/180)),.5+.5*Math.sin(234*(Math.PI/180))],[.5+.25*Math.cos(270*(Math.PI/180)),.5+.25*Math.sin(270*(Math.PI/180))],[.5+.5*Math.cos(306*(Math.PI/180)),.5+.5*Math.sin(306*(Math.PI/180))],[.5+.25*Math.cos(342*(Math.PI/180)),.5+.25*Math.sin(342*(Math.PI/180))],[.5+.5*Math.cos(18*(Math.PI/180)),.5+.5*Math.sin(18*(Math.PI/180))],[.5+.25*Math.cos(54*(Math.PI/180)),.5+.25*Math.sin(54*(Math.PI/180))],[.5+.5*Math.cos(90*(Math.PI/180)),.5+.5*Math.sin(90*(Math.PI/180))]]}]},{id:"OT_colors",title:"Colors",icon:"",items:{}},{id:"OT_line_width",title:"Line Width",icon:"../images/annotation/line_width.png",items:{}},{id:"OT_clear",title:"Clear",icon:"../images/annotation/clear.png"}],c=["#1abc9c","#2ecc71","#3498db","#9b59b6","#8e44ad","#f1c40f","#e67e22","#e74c3c","#ded5d5"],l=10/6,d=_.throttle(function(){t.onResize()},1e3),h=function(){var n,e;if(o.externalWindow){var t={width:o.externalWindow.innerWidth,height:o.externalWindow.innerHeight},r=t.width/l;r<=t.height?(n=t.width,e=r):(e=t.height,n=e*l)}else{var a=o.absoluteParent||o.canvasContainer;n=$(a).width(),e=$(a).height()}$(o.canvasContainer).css({width:n,height:e}),$(o.canvas).css({width:n,height:e}),$(o.canvas).attr({width:n,height:e}),d(),i("resizeCanvas")},u=function(){$(o.resizeSubject).on("resize",_.throttle(function(){h()},500))},p=function(n,e,t){var o=_.property("toolbarId")(e)||"toolbar",i=_.property("toolbarItems")(e)||s,r=_.property("colors")(e)||c,a=function(){var n=t?t:window;return n.document.getElementById(o)};toolbar=new OTSolution.Annotations.Toolbar({session:n,container:a(),colors:r,items:i,externalWindow:t||null})},f=function(){var n=$.Deferred(),e=.8*screen.width|0,t=e/l,o=["templates/screenshare.html?opentok-annotation"].join(""),r=["toolbar=no","location=no","directories=no","status=no","menubar=no","scrollbars=no","resizable=no","copyhistory=no",["width=",e].join(""),["height=",t].join(""),["left=",screen.width/2-e/2].join(""),["top=",screen.height/2-t/2].join("")].join(","),a=window.open(o,"",r);window.onbeforeunload=function(){a.close()},a.toolbar=toolbar,a.OT=OT,a.$=$,a.triggerCloseEvent=function(){i("annotationWindowClosed")};var s=function(){a.createContainerElements?$(a.document).ready(function(){n.resolve(a)}):setTimeout(s,100)};return s(),n.promise()},g=function(){$(o.resizeSubject).off("resize",h),toolbar.remove()},m=function(n,e){var t=$.Deferred();return _.property("screensharing")(e)?f().then(function(o){p(n,e,o),toolbar.createPanel(o),i("startAnnotation",o),t.resolve(o)}):(p(n,e),i("startAnnotation"),t.resolve()),t.promise()},v=function(n,e,r){o.resizeSubject=_.property("externalWindow")(r)||window,o.externalWindow=_.property("externalWindow")(r)||null,o.absoluteParent=_.property("absoluteParent")(r)||null,o.canvasContainer=e,t=new OTSolution.Annotations({feed:n,container:e,externalWindow:o.externalWindow}),toolbar.addCanvas(t),t.onScreenCapture(function(n){var e=window.open(n,"_blank");e.focus()});var a=o.externalWindow?o.externalWindow:window;o.canvas=$(_.first(a.document.getElementsByTagName("canvas"))),u(),h(),i("linkAnnotation")},b=function(){h()},w=function(n){g(),o.canvas=null,n&&(o.externalWindow&&(o.externalWindow.close(),o.externalWindow=null,o.resizeSubject=null),i("endAnnotation"))},S=function(t){n=this,n.options=_.omit(t,"accPack"),e=_.property("accPack")(t),r(),a()};S.prototype={constructor:S,start:m,linkCanvas:v,resizeCanvas:b,end:w},"object"==typeof exports?module.exports=S:"function"==typeof define&&define.amd?define(function(){return S}):this.AnnotationAccPack=S}).call(this),function(){var n,e,t,o,i=function(){if(t){var n=["startCall","endCall","callPropertyChanged","startViewingSharedScreen","endViewingSharedScreen"];t.registerEvents(n)}},r=function(n,e){t&&t.triggerEvent(n,e)},a={clientVersion:"js-vsol-1.0.0",componentId:"avCommunicationAccPack",actionInitialize:"Init",actionStartComm:"Start",actionStopComm:"Stop",variationAttempt:"Attempt",variationError:"Failure",variationSuccess:"Success"},s=function(n,e,t){if(t){var o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3);var i="; expires="+o.toGMTString()}else var i="";var r=n+"="+e+i+"; path=/";return document.cookie=r,r},c=function(n){for(var e=n+"=",t=document.cookie.split(";"),o=0;o<t.length;o++){for(var i=t[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null},l=function(){for(var n=[],e="0123456789abcdef",t=0;36>t;t++)n[t]=e.substr(Math.floor(16*Math.random()),1);n[14]="4",n[19]=e.substr(3&n[19]|8,1),n[8]=n[13]=n[18]=n[23]="-";var o=n.join("");return o},d=function(){var n=window.location.href,t=c("guidAVCommunication");t||s("guidAVCommunication",l(),7);var i={clientVersion:a.clientVersion,source:n,componentId:a.componentId,guid:t};o=new OTKAnalytics(i);var r={sessionId:e.id,connectionId:e.connection.connectionId,partnerId:e.apiKey};o.addSessionInfo(r)},h=function(n,e){var t={action:n,variation:e};o.logEvent(t)},u=function(){var e=n.options.localCallProperties;n.options.user&&(e.name=n.options.user.name),n.publisher=OT.initPublisher("videoHolderSmall",e,function(n){n&&console.log("Error starting a call",n)})},p=function(){return u(),e.publish(n.publisher,function(n){if(n){console.log(["Error starting a call",n.code,"-",n.message].join(""));var e;e=1010===n.code?[n.message,". Check your network connection."].join(""):n.message,console.log(n,e),h(a.actionStartComm,a.variationError)}})},f=function(){n.publisher&&e.unpublish(n.publisher)},g=function(){_.each(n.streams,function(n){e.unsubscribe(n)})},m=function(t){var o;o="screen"===t.videoType?n.options.localScreenProperties:n.options.localCallProperties;var i;i="screen"===t.videoType?"videoHolderSharedScreen":"videoHolderBig";var a=e.subscribe(t,i,o,function(e){if(e){var o=1010===e.code?"Check your network connection.":"";console.log(e,o)}else n.streams.push(a),"screen"===t.videoType&&r("startViewingSharedScreen",a)});n.subscriber=a},v=function(n){return n},b=function(n){return n},w=function(e){n.subscribers.push(e.stream),n._remoteParticipant=e.connection,m(e.stream)},S=function(e){console.log("Participant left the call");var t=e.stream.videoType,o=n.subscribers.indexOf(e.stream);n.subscribers.splice(o,1),"camera"===t?(n.subscriber=null,n._remoteParticipant=null):"screen"===t?r("endViewingSharedScreen"):_.each(n.subscribers,function(n){m(n)})},M=function(n){var e;e="hasAudio"===n.changedProperty?{property:"Audio",enabled:n.newValue}:{property:"Video",enabled:n.newValue},r("callPropertyChanged",e)},P=function(){t?(t.registerEventListener("streamCreated",w),t.registerEventListener("streamDestroyed",S)):(e.on("streamCreated",w),e.on("streamDestroyed",S))},x=function(n,e){if(!n||!n.session)throw new Error("No session provided.");return _.defaults(_.omit(n,e))},y=function(o){n=this;var r=["subscribers","streams"];n.options=x(o,r),_.extend(n,_.defaults(_.pick(o,r),{subscribers:[],streams:[]})),e=_.property("session")(o),t=_.property("accPack")(o),i(),P(),d(),h(a.actionInitialize,a.variationAttempt),h(a.actionInitialize,a.variationSuccess)};y.prototype={constructor:y,start:function(){h(a.actionStartComm,a.variationAttempt),n.options.inSession=!0,n.publisher=p("camera"),$.when(n.publisher.on("streamCreated")).done(function(n){v(n)}).promise(),n.publisher.on("streamDestroyed",function(n){console.log("stream destroyed"),b(n)}),n.publisher.session.on("streamPropertyChanged",function(e){n.publisher.stream===e.stream&&M(e)}),_.each(n.subscribers,function(n){m(n)}),r("startCall"),h(a.actionStartComm,a.variationSuccess)},end:function(){h(a.actionStopComm,a.variationAttempt),n.options.inSession=!1,f("camera"),g(),r("endCall"),h(a.actionStopComm,a.variationSuccess)},enableLocalAudio:function(e){n.publisher&&n.publisher.publishAudio(e)},enableLocalVideo:function(e){n.publisher&&n.publisher.publishVideo(e)},enableRemoteVideo:function(e){n.subscribeer&&n.subscriber.subscribeToVideo(e)},enableRemoteAudio:function(e){n.subscribeer&&n.subscriber.subscribeToAudio(e)}},"object"==typeof exports?module.exports=y:"function"==typeof define&&define.amd?define(function(){return y}):this.CommunicationAccPack=y}.call(this),function(){var n,e,t,o,i=['<div class="video-control circle share-screen" id="startScreenSharing"></div>'].join("\n"),r=['<div class="hidden" id="screenShareView">','<div class="wms-feed-main-video">','<div class="wms-feed-holder" id="videoHolderScreenShare"></div>','<div class="wms-feed-mask"></div>','<img src="/images/mask/video-mask.png"/>',"</div>",'<div class="wms-feed-call-controls" id="feedControlsFromScreen">','<button class="wms-icon-screen active hidden" id="endScreenShareBtn"></button>',"</div>","</div>"].join("\n"),a=['<div id="dialog-form-chrome" class="wms-modal" style="display: none;">','<div class="wms-modal-body">','<div class="wms-modal-title with-icon">','<i class="wms-icon-share-large"></i>',"<span>Screen Share<br/>Extension Installation</span>","</div>","<p>You need a Chrome extension to share your screen. Install Screensharing Extension. Once you have installed, please, click the share screen button again.</p>",'<button id="btn-install-plugin-chrome" class="wms-btn-install">Accept</button>','<button id="btn-cancel-plugin-chrome" class="wms-cancel-btn-install"></button>',"</div>","</div>",'<div id="dialog-form-ff" class="wms-modal" style="display: none;">','<div class="wms-modal-body">','<div class="wms-modal-title with-icon">','<i class="wms-icon-share-large"></i>',"<span>Screen Share<br/>Extension Installation</span>","</div>","<p>You need a Firefox extension to share your screen. Install Screensharing Extension. Once you have installed, refresh your browser and click the share screen button again.</p>",'<a href="#" id="btn-install-plugin-ff" class="wms-btn-install" href="">Install extension</a>','<a href="#" id="btn-cancel-plugin-ff" class="wms-cancel-btn-install"></a>',"</div>","</div>"].join("\n"),s=function(e){$("body").append(a),$(n._screenSharingControls).append(i),$(e).append(r)},c=function(n){$("#startScreenSharing")[n?"show":"hide"]()},l=function(n,e){t&&t.triggerEvent(n,e)},d=function(){var e=function(e){var t=$.Deferred(),o=e||$("#videoHolderScreenShare");return n.publisher=OT.initPublisher(o,n.localScreenProperties,function(n){n?(l("screenSharingError",n),t.reject(_.extend(_.omit(n,"messsage"),{message:"Error starting the screen sharing"}))):t.resolve()}),t.promise()},o=$.Deferred();return n.annotation?t.setupExternalAnnotation().then(function(t){n.annotationWindow=t||null;var i=t.createContainerElements();e(i.publisher).then(function(){o.resolve(i.annotation)})}):e().then(function(){o.resolve()}),o.promise()},h=function(i){o.publish(n.publisher,function(o){if(o){var r=_.omit(o,"message");if(1500===o.code&&-1!==navigator.userAgent.indexOf("Firefox"))$("#dialog-form-ff").toggle();else{var a;a=1010===o.code?"Check your network connection":"Error sharing the screen",r.message=a,l("screenSharingError",r)}}else n.annotation&&t.linkAnnotation(n.publisher,i,n.annotationWindow),e=!0,l("startScreenSharing")})},u=function(){o.unpublish(n.publisher),n.publisher=null},p=function(){var n=$.Deferred();return"http:"===window.location.protocol&&(alert("Screensharing only works under 'https', please add 'https://' in front of your debugger url."),n.reject("https required")),OT.checkScreenSharingCapability(function(e){console.log("checkScreenSharingCapability",e),e.supported&&e.extensionRegistered?e.extensionInstalled?n.resolve():($("#dialog-form-chrome").toggle(),n.reject("screensharing extension not installed")):"Firefox"===OT.$.browser()&&e.extensionInstalled?n.resolve():(alert("This browser does not support screen sharing! Please use Chrome, Firefox or IE!"),n.reject("browser support not available"))}),n.promise()},f=function(){p(n.extensionID,n.extensionPathFF).then(d).then(h).fail(function(n){console.log("Error starting screensharing: ",n)})},g=function(n){u(),e=!1,n&&c(!1),l("endScreenSharing")},m=function(){if(t){var n=["startScreenSharing","endScreenSharing","screenSharingError"];t.registerEvents(n)}},v=function(){var o=_.throttle(function(){e?g():f()},750);$("#startScreenSharing").on("click",o),$("#btn-install-plugin-chrome").on("click",function(){chrome.webstore.install(["https://chrome.google.com/webstore/detail/",n.extensionID].join(""),function(n){console.log("success",n)},function(n){console.log("error",n)}),$("#dialog-form-chrome").toggle()}),$("#btn-cancel-plugin-chrome").on("click",function(){$("#dialog-form-chrome").toggle()}),$("#btn-install-plugin-ff").prop("href",n.extensionPathFF),$("#btn-install-plugin-ff").on("click",function(){$("#dialog-form-ff").toggle()}),$("#btn-cancel-plugin-ff").on("click",function(){$("#dialog-form-ff").toggle()}),t&&(t.registerEventListener("startCall",function(){c(!0)}),t.registerEventListener("endCall",function(){e?g(!0):c(!1)}),t.registerEventListener("annotationWindowClosed",function(){g()}))},b=function(n,e){if("Chrome"===OT.$.browser()){if(!n||!n.length)throw new Error("Error starting the screensharing. Chrome extensionID required");$("<link/>",{rel:"chrome-webstore-item",href:["https://chrome.google.com/webstore/detail/",n].join("")}).appendTo("head"),OT.registerScreenSharingExtension("chrome",n,2)}if(!("Firefox"!==OT.$.browser()||e&&e.length))throw new Error("Error starting the screensharing. Firefox screensharing extension required")},w=function(n){if(!_.property("session",n))throw new Error("Screen Share Acc Pack requires an OpenTok session");o=_.property("session")(n),t=_.property("accPack")(n),b(_.property("extensionID")(n),_.property("extensionPathFF")(n))},S=function(e){n=this,w(e);var t=["annotation","extensionURL","extensionID","extensionPathFF","screensharingParent","localScreenProperties"];_.extend(n,_.defaults(_.pick(e,t)),{screenSharingParent:"#videoContainer",_screenSharingControls:"#feedControls"}),s(n.screensharingParent),m(),v()};S.prototype={constructor:S,extensionAvailable:p,start:f,end:g},"object"==typeof exports?module.exports=S:"function"==typeof define&&define.amd?define(function(){return S}):this.ScreenSharingAccPack=S}.call(this),function(){var n,e,t,o={},i=function(n,t){e&&e.triggerEvent(n,t)},r=function(){var n=["startAnnotation","linkAnnotation","resizeCanvas","annotationWindowClosed","endAnnotation"];e.registerEvents(n)},a=function(){var n=['<div id="toolbar"></div>'].join("\n");$("body").append(n)},s=[{id:"OT_pen",title:"Pen",icon:"../images/annotation/freehand.png",selectedIcon:"../images/annotation/freehand_selected.png"},{id:"OT_line",title:"Line",icon:"../images/annotation/line.png",selectedIcon:"../images/annotation/line_selected.png"},{id:"OT_text",title:"Text",icon:"../images/annotation/text.png",selectedIcon:"../images/annotation/text.png"},{id:"OT_shapes",title:"Shapes",icon:"../images/annotation/shapes.png",items:[{id:"OT_arrow",title:"Arrow",icon:"../images/annotation/arrow.png"},{id:"OT_rect",title:"Rectangle",icon:"../images/annotation/rectangle.png"},{id:"OT_oval",title:"Oval",icon:"../images/annotation/oval.png"},{id:"OT_star",title:"Star",icon:"../images/annotation/star.png",points:[[.5+.5*Math.cos(90*(Math.PI/180)),.5+.5*Math.sin(90*(Math.PI/180))],[.5+.25*Math.cos(126*(Math.PI/180)),.5+.25*Math.sin(126*(Math.PI/180))],[.5+.5*Math.cos(162*(Math.PI/180)),.5+.5*Math.sin(162*(Math.PI/180))],[.5+.25*Math.cos(198*(Math.PI/180)),.5+.25*Math.sin(198*(Math.PI/180))],[.5+.5*Math.cos(234*(Math.PI/180)),.5+.5*Math.sin(234*(Math.PI/180))],[.5+.25*Math.cos(270*(Math.PI/180)),.5+.25*Math.sin(270*(Math.PI/180))],[.5+.5*Math.cos(306*(Math.PI/180)),.5+.5*Math.sin(306*(Math.PI/180))],[.5+.25*Math.cos(342*(Math.PI/180)),.5+.25*Math.sin(342*(Math.PI/180))],[.5+.5*Math.cos(18*(Math.PI/180)),.5+.5*Math.sin(18*(Math.PI/180))],[.5+.25*Math.cos(54*(Math.PI/180)),.5+.25*Math.sin(54*(Math.PI/180))],[.5+.5*Math.cos(90*(Math.PI/180)),.5+.5*Math.sin(90*(Math.PI/180))]]}]},{id:"OT_colors",title:"Colors",icon:"",items:{}},{id:"OT_line_width",title:"Line Width",icon:"../images/annotation/line_width.png",items:{}},{id:"OT_clear",title:"Clear",icon:"../images/annotation/clear.png"}],c=["#1abc9c","#2ecc71","#3498db","#9b59b6","#8e44ad","#f1c40f","#e67e22","#e74c3c","#ded5d5"],l=10/6,d=_.throttle(function(){t.onResize()},1e3),h=function(){var n,e;if(o.externalWindow){var t={width:o.externalWindow.innerWidth,height:o.externalWindow.innerHeight},r=t.width/l;r<=t.height?(n=t.width,e=r):(e=t.height,n=e*l)}else{var a=o.absoluteParent||o.canvasContainer;n=$(a).width(),e=$(a).height()}$(o.canvasContainer).css({width:n,height:e}),$(o.canvas).css({width:n,height:e}),$(o.canvas).attr({width:n,height:e}),d(),i("resizeCanvas")},u=function(){$(o.resizeSubject).on("resize",_.throttle(function(){h()},500))},p=function(n,e,t){var o=_.property("toolbarId")(e)||"toolbar",i=_.property("toolbarItems")(e)||s,r=_.property("colors")(e)||c,a=function(){var n=t?t:window;return n.document.getElementById(o)};toolbar=new OTSolution.Annotations.Toolbar({session:n,container:a(),colors:r,items:i,externalWindow:t||null})},f=function(){var n=$.Deferred(),e=.8*screen.width|0,t=e/l,o=["templates/screenshare.html?opentok-annotation"].join(""),r=["toolbar=no","location=no","directories=no","status=no","menubar=no","scrollbars=no","resizable=no","copyhistory=no",["width=",e].join(""),["height=",t].join(""),["left=",screen.width/2-e/2].join(""),["top=",screen.height/2-t/2].join("")].join(","),a=window.open(o,"",r);window.onbeforeunload=function(){a.close()},a.toolbar=toolbar,a.OT=OT,a.$=$,a.triggerCloseEvent=function(){i("annotationWindowClosed")};var s=function(){a.createContainerElements?$(a.document).ready(function(){n.resolve(a)}):setTimeout(s,100)};return s(),n.promise()},g=function(){$(o.resizeSubject).off("resize",h),toolbar.remove()},m=function(n,e){var t=$.Deferred();return _.property("screensharing")(e)?f().then(function(o){p(n,e,o),toolbar.createPanel(o),i("startAnnotation",o),t.resolve(o)}):(p(n,e),i("startAnnotation"),t.resolve()),t.promise()},v=function(n,e,r){o.resizeSubject=_.property("externalWindow")(r)||window,o.externalWindow=_.property("externalWindow")(r)||null,o.absoluteParent=_.property("absoluteParent")(r)||null,o.canvasContainer=e,t=new OTSolution.Annotations({feed:n,container:e,externalWindow:o.externalWindow}),toolbar.addCanvas(t),t.onScreenCapture(function(n){var e=window.open(n,"_blank");e.focus()});var a=o.externalWindow?o.externalWindow:window;o.canvas=$(_.first(a.document.getElementsByTagName("canvas"))),u(),h(),i("linkAnnotation")},b=function(){h()},w=function(n){g(),o.canvas=null,n&&(o.externalWindow&&(o.externalWindow.close(),o.externalWindow=null,o.resizeSubject=null),i("endAnnotation"))},S=function(t){n=this,n.options=_.omit(t,"accPack"),e=_.property("accPack")(t),r(),a()};S.prototype={constructor:S,start:m,linkCanvas:v,resizeCanvas:b,end:w},"object"==typeof exports?module.exports=S:"function"==typeof define&&define.amd?define(function(){return S}):this.AnnotationAccPack=S}.call(this);